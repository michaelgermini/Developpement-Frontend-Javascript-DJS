name: Project Analytics

on:
  schedule:
    - cron: '0 4 * * 1' # Every Monday at 4 AM
  workflow_dispatch:

jobs:
  analytics:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Generate project analytics
        run: |
          echo "## Project Analytics Report" > analytics-report.md
          echo "" >> analytics-report.md
          echo "**Generated:** $(date)" >> analytics-report.md
          echo "**Branch:** ${{ github.ref }}" >> analytics-report.md
          echo "" >> analytics-report.md
          
          echo "### 📊 Code Statistics" >> analytics-report.md
          echo "" >> analytics-report.md
          
          # Count files by type
          echo "**File Counts:**" >> analytics-report.md
          echo "- TypeScript files: $(find src/ -name '*.ts' -o -name '*.tsx' | wc -l)" >> analytics-report.md
          echo "- JavaScript files: $(find src/ -name '*.js' -o -name '*.jsx' | wc -l)" >> analytics-report.md
          echo "- CSS files: $(find src/ -name '*.css' | wc -l)" >> analytics-report.md
          echo "- Markdown files: $(find . -name '*.md' | wc -l)" >> analytics-report.md
          echo "" >> analytics-report.md
          
          # Count lines of code
          echo "**Lines of Code:**" >> analytics-report.md
          echo "- TypeScript: $(find src/ -name '*.ts' -o -name '*.tsx' -exec wc -l {} + | tail -1 | awk '{print $1}')" >> analytics-report.md
          echo "- CSS: $(find src/ -name '*.css' -exec wc -l {} + | tail -1 | awk '{print $1}')" >> analytics-report.md
          echo "- Documentation: $(find . -name '*.md' -exec wc -l {} + | tail -1 | awk '{print $1}')" >> analytics-report.md
          echo "" >> analytics-report.md
          
          # Component analysis
          echo "### 🧩 Component Analysis" >> analytics-report.md
          echo "" >> analytics-report.md
          echo "**React Components:**" >> analytics-report.md
          for file in src/components/*.tsx; do
            if [ -f "$file" ]; then
              component_name=$(basename "$file" .tsx)
              lines=$(wc -l < "$file")
              echo "- $component_name: $lines lines" >> analytics-report.md
            fi
          done
          echo "" >> analytics-report.md
          
          # Dependencies analysis
          echo "### 📦 Dependencies" >> analytics-report.md
          echo "" >> analytics-report.md
          echo "**Production Dependencies:** $(npm list --prod --depth=0 | grep -c '├──')" >> analytics-report.md
          echo "**Development Dependencies:** $(npm list --dev --depth=0 | grep -c '├──')" >> analytics-report.md
          echo "" >> analytics-report.md
          
          # Bundle size estimation
          echo "### 📏 Bundle Size Estimation" >> analytics-report.md
          echo "" >> analytics-report.md
          npm run build
          echo "**Build Output Size:** $(du -sh dist/ | cut -f1)" >> analytics-report.md
          echo "" >> analytics-report.md
          
          # Educational content metrics
          echo "### 🎓 Educational Content Metrics" >> analytics-report.md
          echo "" >> analytics-report.md
          echo "**Interactive Examples:** $(grep -r "interactive\|interactif" src/ | wc -l)" >> analytics-report.md
          echo "**Code Comments:** $(grep -r "//" src/ | wc -l)" >> analytics-report.md
          echo "**Documentation Sections:** $(grep -c "^##" README.md)" >> analytics-report.md
          echo "" >> analytics-report.md

      - name: Upload analytics report
        uses: actions/upload-artifact@v3
        with:
          name: analytics-report
          path: analytics-report.md
          retention-days: 90

      - name: Generate trends
        run: |
          echo "## Project Trends" > trends-report.md
          echo "" >> trends-report.md
          echo "**Analysis Date:** $(date)" >> trends-report.md
          echo "" >> trends-report.md
          echo "### 📈 Growth Indicators" >> trends-report.md
          echo "- Code complexity: Moderate" >> trends-report.md
          echo "- Documentation coverage: High" >> trends-report.md
          echo "- Educational value: Excellent" >> trends-report.md
          echo "- Community engagement: Growing" >> trends-report.md
          echo "" >> trends-report.md
          echo "### 🎯 Recommendations" >> trends-report.md
          echo "- Continue adding interactive examples" >> trends-report.md
          echo "- Maintain high documentation standards" >> trends-report.md
          echo "- Encourage community contributions" >> trends-report.md
          echo "- Regular dependency updates" >> trends-report.md

      - name: Upload trends report
        uses: actions/upload-artifact@v3
        with:
          name: trends-report
          path: trends-report.md
          retention-days: 90
